# Story 7.4: Criar Seed Data de Books de Paradas (MVP)

## Status
**Draft**

## Story

**Como** desenvolvedor,
**Eu quero** carregar Books de Paradas via seed.sql,
**Para que** operadores tenham códigos disponíveis no MVP sem aguardar Atividade 06.

## Acceptance Criteria

1. Arquivo `supabase/seed-books.sql` criado
2. Estrutura hierárquica: Classe → Grande Parada → Apontamento → Grupo → Detalhamento
3. Seed data para **10 linhas SPEP** (~50 códigos por linha = ~500 registros): Linha A a SLE
4. INSERTs em tabela `books_paradas`: (linha_id, codigo, classe, grande_parada, apontamento, grupo, detalhamento, is_ativo)
5. Códigos comuns em todas as linhas: P1.1 (Manutenção Planejada), P2.1 (Quebra/Falha), P3.1 (Falta de Material)
6. Códigos específicos por linha: baseado em características
7. Script executável: `supabase db reset` → limpa dados + aplica migrations + executa seed
8. Validação: query `SELECT COUNT(*) FROM books_paradas GROUP BY linha_id` → deve retornar ~50 por linha

## Tasks / Subtasks

- [ ] **Task 1: Verificar Tabela books_paradas Existe** (AC: 4)
  - [ ] Se criada em Story 1.4 → OK
  - [ ] Se não: criar migration adicional
  - [ ] Campos necessários: id, linha_id, codigo, classe, grande_parada, apontamento, grupo, detalhamento, is_ativo

- [ ] **Task 2: Criar Arquivo seed-books.sql** (AC: 1)
  - [ ] Criar `supabase/seed-books.sql`
  - [ ] Header: comentário explicativo
  - [ ] Organizar por linha (comentários separando)

- [ ] **Task 3: Definir Estrutura Hierárquica** (AC: 2)
  - [ ] Classe: Parada Estratégica, Planejada, Não Planejada
  - [ ] Grande Parada: Manutenção, Falha, Falta Material, Setup, etc.
  - [ ] Apontamento: Detalhamento específico
  - [ ] Grupo/Detalhamento: Níveis adicionais (nullable)

- [ ] **Task 4: Criar Códigos Comuns (Todas Linhas)** (AC: 5)
  - [ ] P1.1 - Manutenção Planejada
  - [ ] P1.2 - Sem Programação PMP
  - [ ] P2.1 - Quebra/Falha Mecânica
  - [ ] P2.2 - Quebra/Falha Elétrica
  - [ ] P3.1 - Falta de Material (Insumos)
  - [ ] P3.2 - Falta de Material (Embalagem)
  - [ ] P4.1 - Setup/Troca de Produto
  - [ ] P5.1 - Limpeza/Sanitização
  - [ ] ... (até ~30 códigos comuns)

- [ ] **Task 5: Criar Códigos Específicos por Linha** (AC: 6)
  - [ ] Linha A: códigos específicos (~20)
  - [ ] Linha B: variações (~20)
  - [ ] ... repetir para 10 linhas
  - [ ] Exemplo específico: "P6.1 - Troca de Filtro Linha A"

- [ ] **Task 6: Gerar INSERTs SQL** (AC: 4)
  - [ ] Para cada código: INSERT INTO books_paradas VALUES (...)
  - [ ] Usar gen_random_uuid() para id
  - [ ] Lookup linha_id via SELECT (SELECT id FROM linhas WHERE nome = 'Linha A')
  - [ ] is_ativo = TRUE por padrão

- [ ] **Task 7: Organizar por Linha**
  - [ ] Comentário: `-- LINHA A (SPEP Envase)`
  - [ ] ~50 INSERTs
  - [ ] Comentário: `-- LINHA B (SPEP Envase)`
  - [ ] ~50 INSERTs
  - [ ] Repetir para 10 linhas

- [ ] **Task 8: Executar Seed** (AC: 7)
  - [ ] `supabase db reset` (aplica migrations + seed.sql + seed-books.sql)
  - [ ] Ou: `psql -f supabase/seed-books.sql`
  - [ ] Verificar sem erros

- [ ] **Task 9: Validar Dados Carregados** (AC: 8)
  - [ ] Query: `SELECT linha_id, COUNT(*) FROM books_paradas GROUP BY linha_id`
  - [ ] Cada linha deve ter ~50 registros
  - [ ] Total: ~500 registros

- [ ] **Task 10: Testar no Formulário**
  - [ ] Abrir formulário de apontamento (Story 3.1 - futuro)
  - [ ] Selecionar "Linha A"
  - [ ] Dropdown "Código de Parada" deve listar ~50 códigos
  - [ ] Buscar "manut" → deve filtrar para manutenção

- [ ] **Task 11: Documentar em README**
  - [ ] Seção "Dados de Teste"
  - [ ] Explicar que Books estão seedados
  - [ ] CRUD completo será pós-MVP (aguardando Atividade 06)

## Dev Notes

### Previous Story Insights
**Story Anterior:** 7.1 (Velocidades Nominais)
- Dados mestres sendo criados
- Books de Paradas necessários ANTES do Epic 3 (operador precisa para apontar)
- Esta story deve vir logo após Epic 1

**Sequência Recomendada:**
```
Epic 1 → Story 7.4 (Books) → Story 7.1 (Velocidades) → Epic 2
```

### Why Books de Paradas?

**[Fonte: docs/project/04-Glossario-Termos.md + Epic 3]**

**Book de Paradas:** Catálogo de códigos de paradas específicos de cada linha.

**Hierarquia (5 níveis):**
1. **Classe:** Estratégica, Planejada, Não Planejada
2. **Grande Parada:** Manutenção, Falha, Setup, etc.
3. **Apontamento:** Detalhamento do motivo
4. **Grupo:** (opcional) Agrupamento adicional
5. **Detalhamento:** (opcional) Nível máximo de detalhe

**Exemplo:**
```
Código: P2.1
Classe: Parada Não Planejada
Grande Parada: Falha Mecânica
Apontamento: Quebra de Correia Transportadora
Grupo: Transporte
Detalhamento: Correia Setor 3
```

### Seed Data Template

```sql
-- File: supabase/seed-books.sql
-- Seed Data: Books de Paradas (10 linhas SPEP)
-- Total: ~500 códigos (50 por linha)

-- ============================================
-- LINHA A (SPEP Envase)
-- ============================================

INSERT INTO books_paradas (linha_id, codigo, classe, grande_parada, apontamento, grupo, detalhamento, is_ativo)
VALUES
  -- Paradas Estratégicas
  ((SELECT id FROM linhas WHERE nome = 'Linha A' AND setor_id = (SELECT id FROM setores WHERE nome = 'SPEP')),
   'P0.1', 'Parada Estratégica', 'Sem Programação', 'Sem Ordem de Produção', NULL, NULL, TRUE),

  ((SELECT id FROM linhas WHERE nome = 'Linha A' AND setor_id = (SELECT id FROM setores WHERE nome = 'SPEP')),
   'P0.2', 'Parada Estratégica', 'Reunião', 'Reunião Gerencial', NULL, NULL, TRUE),

  -- Paradas Planejadas
  ((SELECT id FROM linhas WHERE nome = 'Linha A' AND setor_id = (SELECT id FROM setores WHERE nome = 'SPEP')),
   'P1.1', 'Parada Planejada', 'Manutenção Preventiva', 'Manutenção Programada', 'Mecânica', NULL, TRUE),

  ((SELECT id FROM linhas WHERE nome = 'Linha A' AND setor_id = (SELECT id FROM setores WHERE nome = 'SPEP')),
   'P1.2', 'Parada Planejada', 'Manutenção Preventiva', 'Lubrificação', 'Mecânica', NULL, TRUE),

  ((SELECT id FROM linhas WHERE nome = 'Linha A' AND setor_id = (SELECT id FROM setores WHERE nome = 'SPEP')),
   'P1.3', 'Parada Planejada', 'Setup', 'Troca de Produto', NULL, NULL, TRUE),

  ((SELECT id FROM linhas WHERE nome = 'Linha A' AND setor_id = (SELECT id FROM setores WHERE nome = 'SPEP')),
   'P1.4', 'Parada Planejada', 'Limpeza', 'Sanitização Programada', NULL, NULL, TRUE),

  -- Paradas Não Planejadas - Falhas
  ((SELECT id FROM linhas WHERE nome = 'Linha A' AND setor_id = (SELECT id FROM setores WHERE nome = 'SPEP')),
   'P2.1', 'Parada Não Planejada', 'Falha Mecânica', 'Quebra de Correia', 'Transporte', NULL, TRUE),

  ((SELECT id FROM linhas WHERE nome = 'Linha A' AND setor_id = (SELECT id FROM setores WHERE nome = 'SPEP')),
   'P2.2', 'Parada Não Planejada', 'Falha Mecânica', 'Quebra de Rolamento', 'Mecânica', NULL, TRUE),

  ((SELECT id FROM linhas WHERE nome = 'Linha A' AND setor_id = (SELECT id FROM setores WHERE nome = 'SPEP')),
   'P2.3', 'Parada Não Planejada', 'Falha Elétrica', 'Queda de Energia', 'Elétrica', NULL, TRUE),

  ((SELECT id FROM linhas WHERE nome = 'Linha A' AND setor_id = (SELECT id FROM setores WHERE nome = 'SPEP')),
   'P2.4', 'Parada Não Planejada', 'Falha Elétrica', 'Sensor Defeituoso', 'Automação', NULL, TRUE),

  -- Paradas Não Planejadas - Falta de Material
  ((SELECT id FROM linhas WHERE nome = 'Linha A' AND setor_id = (SELECT id FROM setores WHERE nome = 'SPEP')),
   'P3.1', 'Parada Não Planejada', 'Falta de Material', 'Falta de Insumo', 'Produção', NULL, TRUE),

  ((SELECT id FROM linhas WHERE nome = 'Linha A' AND setor_id = (SELECT id FROM setores WHERE nome = 'SPEP')),
   'P3.2', 'Parada Não Planejada', 'Falta de Material', 'Falta de Embalagem', 'Produção', NULL, TRUE),

  ((SELECT id FROM linhas WHERE nome = 'Linha A' AND setor_id = (SELECT id FROM setores WHERE nome = 'SPEP')),
   'P3.3', 'Parada Não Planejada', 'Falta de Material', 'Falta de Rótulo', 'Produção', NULL, TRUE),

  -- Códigos Específicos Linha A
  ((SELECT id FROM linhas WHERE nome = 'Linha A' AND setor_id = (SELECT id FROM setores WHERE nome = 'SPEP')),
   'P6.1', 'Parada Planejada', 'Manutenção', 'Troca de Filtro Específico Linha A', 'Mecânica', 'Filtro Setor 2', TRUE),

  -- ... continuar até ~50 códigos para Linha A
  ;

-- ============================================
-- LINHA B (SPEP Envase)
-- ============================================

-- Códigos Comuns (reutilizar P0.1, P1.1, P2.1, etc. mas com linha_id diferente)
INSERT INTO books_paradas (linha_id, codigo, classe, grande_parada, apontamento, grupo, detalhamento, is_ativo)
VALUES
  ((SELECT id FROM linhas WHERE nome = 'Linha B' AND setor_id = (SELECT id FROM setores WHERE nome = 'SPEP')),
   'P0.1', 'Parada Estratégica', 'Sem Programação', 'Sem Ordem de Produção', NULL, NULL, TRUE),
  -- ... repetir códigos comuns

  -- Códigos Específicos Linha B
  ((SELECT id FROM linhas WHERE nome = 'Linha B' AND setor_id = (SELECT id FROM setores WHERE nome = 'SPEP')),
   'P6.2', 'Parada Planejada', 'Manutenção', 'Ajuste de Válvula Específico Linha B', 'Mecânica', NULL, TRUE),
  -- ... continuar
  ;

-- Repetir para Linha C, D, E, F, G, H, I, SLE
-- ... (total ~500 INSERTs)
```

### Códigos Comuns (Template)

**Reutilizar em todas as 10 linhas:**

| Código | Classe | Grande Parada | Apontamento |
|--------|--------|---------------|-------------|
| P0.1 | Estratégica | Sem Programação | Sem OP |
| P0.2 | Estratégica | Reunião | Reunião Gerencial |
| P1.1 | Planejada | Manutenção | Manutenção Programada |
| P1.2 | Planejada | Setup | Troca de Produto |
| P1.3 | Planejada | Limpeza | Sanitização |
| P2.1 | Não Planejada | Falha Mecânica | Quebra Geral |
| P2.2 | Não Planejada | Falha Elétrica | Sensor/Automação |
| P3.1 | Não Planejada | Falta Material | Insumos |
| P3.2 | Não Planejada | Falta Material | Embalagem |
| P4.1 | Não Planejada | Qualidade | Produto Fora Especificação |
| ... | ... | ... | ... |

**Total Comuns:** ~30 códigos × 10 linhas = 300 registros

**Específicos:** ~20 códigos × 10 linhas = 200 registros

**Total Geral:** ~500 registros

### Validation Query

```sql
-- Verificar count por linha
SELECT
  l.nome as linha,
  COUNT(bp.id) as total_codigos
FROM linhas l
LEFT JOIN books_paradas bp ON l.id = bp.linha_id
WHERE l.setor_id = (SELECT id FROM setores WHERE nome = 'SPEP')
GROUP BY l.nome
ORDER BY l.nome;

-- Resultado esperado:
-- Linha A  | 50
-- Linha B  | 50
-- Linha C  | 50
-- ...
-- SLE      | 50
```

### Integration with Story 3.4

**Story 3.4 (Epic 3) usa esses dados:**
```typescript
// Buscar códigos ao selecionar linha
const { data: codigos } = await supabase
  .from('books_paradas')
  .select('codigo, grande_parada, apontamento')
  .eq('linha_id', linhaId)
  .eq('is_ativo', true)
  .order('codigo')

// Exibir no combobox: "P1.1 - Manutenção Planejada"
```

### Future: CRUD Interface (Pós-MVP)

**[Fonte: Epic 7, Story 7.4 nota final]**

> "**Nota:** CRUD interface de Books fica pós-MVP (aguardando Atividade 06 documentar hierarquia completa)"

Por enquanto:
- ✅ Seed data estático (SQL)
- ❌ Interface de cadastro (pós-MVP)
- ❌ Atividade 06 não existe ainda (gap na documentação original)

## Change Log

| Date | Version | Description | Author |
|------|---------|-------------|---------|
| 2025-10-26 | 1.0 | História criada | Sarah (Product Owner) |

---

## Dev Agent Record

### Agent Model Used
_A ser preenchido pelo Dev Agent_

### Debug Log References
_A ser preenchido pelo Dev Agent_

### Completion Notes
_A ser preenchido pelo Dev Agent_

### File List
_A ser preenchido pelo Dev Agent_

---

## QA Results
_A ser preenchido pelo QA Agent_

# Story 001.007: Apontamento Manual de Produção

## Status
Draft

## Story

**As a** operador de produção,
**I want** registrar manualmente unidades produzidas quando não há CLP,
**so that** a produção seja contabilizada no cálculo de OEE mesmo sem integração automática.

## Acceptance Criteria

1. Modal `ModalApontamentoProducao` criado em `src/components/operacao/`
2. Modal acessível a partir da tela de operação (botão "Apontar Produção")
3. Campos: Lote (readonly, pré-preenchido), Data (date, default hoje), Hora (time, default agora), Unidades Produzidas (number), Observação (textarea opcional)
4. Validação: unidades > 0
5. Ao salvar: INSERT em tbapontamentoproducao com fonte_dados = 'MANUAL'
6. API `apontarProducaoManual()` criada em `producao.api.ts`
7. Toast de sucesso após salvar
8. Modal fecha após sucesso
9. Lista de apontamentos atualiza (se existir visualização)
10. Tipos TypeScript criados

## Tasks / Subtasks

- [ ] Criar tipos (AC: 10)
  - [ ] Criar/atualizar src/types/producao.ts
  - [ ] interface ApontamentoProducaoDTO

- [ ] Criar API (AC: 6)
  - [ ] Criar src/services/api/producao.api.ts
  - [ ] apontarProducaoManual(dto): Promise<void>
  - [ ] INSERT em tbapontamentoproducao

- [ ] Criar modal (AC: 1, 3, 4)
  - [ ] src/components/operacao/ModalApontamentoProducao.tsx
  - [ ] Props: lote_id, aberto, onFechar, onSucesso
  - [ ] Form com campos conforme AC 3
  - [ ] Validação unidades > 0

- [ ] Implementar salvamento (AC: 5, 7, 8, 9)
  - [ ] useMutation apontarProducaoManual
  - [ ] onSuccess → toast + onSucesso() + fechar modal
  - [ ] onError → toast de erro

- [ ] Integrar na tela de operação (AC: 2)
  - [ ] Editar src/pages/OperacaoDetalheOP.tsx
  - [ ] Adicionar botão "Apontar Produção"
  - [ ] State para controlar abertura do modal

## Dev Notes

### Database INSERT
```sql
INSERT INTO tbapontamentoproducao (
  lote_id, linha_id, turno_id,
  data_apontamento, hora_apontamento,
  unidades_produzidas, fonte_dados,
  created_by
) VALUES (...)
```

### fonte_dados
Usar 'MANUAL' (enum fonte_dados_enum)

## Change Log
| Date       | Version | Description | Author |
|------------|---------|-------------|--------|
| 2025-11-16 | 1.0     | Story criada| Sarah  |

# Story 001.006: Cadastro de Velocidades Nominais

## Status
Draft

## Story

**As a** gestor de produção,
**I want** cadastrar e gerenciar velocidades nominais (Und/h) por linha e produto,
**so that** o sistema possa usar essas velocidades no cálculo correto de Performance no OEE.

## Acceptance Criteria

1. Página `src/pages/CadastroVelocidades.tsx` criada acessível via rota `/cadastros/velocidades`
2. Tabela exibe velocidades cadastradas com colunas: Linha, Produto, Velocidade (Und/h), Observação, Ações
3. Botão "Nova Velocidade" abre modal de cadastro
4. Modal de cadastro com campos: Linha (select), Produto (select), Velocidade (number), Observação (textarea)
5. Validação: velocidade deve ser > 0
6. Validação: não permitir duplicata (mesma linha + produto)
7. Ao salvar: INSERT em tbvelocidadenominal via API
8. Botão "Editar" abre modal pré-preenchido
9. Ao editar: UPDATE em tbvelocidadenominal via API
10. Botão "Excluir" com confirmação → soft delete (deletado = 'S')
11. API `src/services/api/velocidade.api.ts` criada com funções CRUD
12. Tipos `src/types/velocidade.ts` criados
13. Filtro por linha funcional
14. Mensagem de sucesso/erro após cada operação
15. Lista atualiza automaticamente após operações

## Tasks / Subtasks

- [ ] Criar tipos TypeScript (AC: 12)
  - [ ] Criar src/types/velocidade.ts
  - [ ] interface VelocidadeNominal
  - [ ] interface CriarVelocidadeDTO
  - [ ] interface AtualizarVelocidadeDTO

- [ ] Criar API (AC: 11)
  - [ ] Criar src/services/api/velocidade.api.ts
  - [ ] listarVelocidades(): Promise<VelocidadeNominal[]>
  - [ ] criarVelocidade(dto): Promise<VelocidadeNominal>
  - [ ] atualizarVelocidade(id, dto): Promise<VelocidadeNominal>
  - [ ] excluirVelocidade(id): Promise<void> (soft delete)

- [ ] Criar página (AC: 1, 2, 3, 13)
  - [ ] Criar src/pages/CadastroVelocidades.tsx
  - [ ] useQuery para listar velocidades
  - [ ] Header com título + botão "Nova Velocidade"
  - [ ] Filtro por linha (select)
  - [ ] Tabela com colunas conforme AC 2
  - [ ] Botões de ação (Editar, Excluir)

- [ ] Criar modal de cadastro/edição (AC: 4, 5, 6, 8)
  - [ ] Componente ModalVelocidade
  - [ ] Select de linha (buscar de tblinhaproducao)
  - [ ] Select de produto (buscar de tbproduto)
  - [ ] Input number velocidade (validação > 0)
  - [ ] Textarea observação
  - [ ] useMutation para criar/atualizar
  - [ ] Validação duplicata (verificar se já existe antes de salvar)

- [ ] Implementar exclusão (AC: 10)
  - [ ] Dialog de confirmação
  - [ ] useMutation para excluir
  - [ ] Soft delete (UPDATE deletado = 'S')

- [ ] Feedback e atualização (AC: 14, 15)
  - [ ] Toast de sucesso após criar/editar/excluir
  - [ ] Toast de erro se operação falhar
  - [ ] Invalidar query após mutações (queryClient.invalidateQueries)

- [ ] Adicionar rota (AC: 1)
  - [ ] Editar arquivo de rotas
  - [ ] <Route path="/cadastros/velocidades" element={<CadastroVelocidades />} />

## Dev Notes

### Database Fields (tbvelocidadenominal)
- velocidade_id (PK)
- linhaproducao_id (FK)
- produto_id (FK)
- velocidade (NUMERIC)
- observacao (TEXT)
- deletado ('S'/'N')

### API Pattern
```typescript
export const listarVelocidades = async () => {
  const { data, error } = await supabase
    .from('tbvelocidadenominal')
    .select('*, linha:tblinhaproducao(linhaproducao), produto:tbproduto(descricao)')
    .eq('deletado', 'N')
    .order('linhaproducao_id');
  if (error) throw error;
  return data;
};
```

## Change Log
| Date       | Version | Description | Author |
|------------|---------|-------------|--------|
| 2025-11-16 | 1.0     | Story criada| Sarah  |

# Changelog

## [Unreleased]
- Ajustado o layout dos campos "Funcionário" e "Matrícula" no `UsuariosCad` com espaçamento e botões condicionais pela seleção.
- Evitada a sobrescrita das aplicações selecionadas manualmente ao recarregar apps do usuário no `UsuariosCad`.
- Removida a instrumentação de depuração do filtro de perfis após validação em `UsuariosCad`.
- Adicionado dropdown de Aplicação no cadastro de usuários (criação e edição) com opções carregadas via `get_user_apps` e fallback para `tbapp`.
- Ajustada a dependência do `useCallback` no carregamento de aplicações para eliminar aviso de lint no `UsuariosCad`.
- Corrigidos tipos no `Dashboard` para evitar erros de build do TypeScript.
- Removida função de parsing de hora não utilizada no `Dashboard` para corrigir lint.
- Corrigida importação do `CardDescription` no `Dashboard` após ajuste do card de OEE.
- Removida a linha de texto "OEE total" dos cards do `Dashboard`.
- Adicionado botão "Fechar" no filtro de linha do `Dashboard` para manter o menu aberto durante seleções múltiplas.
- Adicionada busca textual no filtro de linha de produção do `Dashboard`.
- Permitida seleção múltipla de linhas de produção no filtro do `Dashboard`, aplicando filtro por conjunto nas linhas.
- Removida função local não utilizada do `Dashboard` para atender lint.
- Ajustada a data inicial do período do `Dashboard` para iniciar no dia 01 de três meses antes da data atual do servidor.
- Mantido o filtro de turno do `Dashboard` com padrão "Todos" na primeira carga da página.
- Centralizado o texto de copyright do `Login` em uma constante reutilizada nos layouts mobile e desktop.
- Adicionado botão de visualizar/ocultar senha no campo de senha da página de `Login` (mobile e desktop).
- Aplicada máscara visual HH:MM nos campos de hora durante a digitação no `ApontamentoOEE`.
- Reduzida a largura dos campos de Hora Inicial e Hora Final no `ApontamentoOEE`.
- Reposicionado o botão de registrar parada para a linha do tipo de parada no `ApontamentoOEE`.
- Reorganizada a linha do tipo de parada para posicionar Hora Inicial/Final ao lado do botão no `ApontamentoOEE`.
- Permitido registrar quantidade produzida zero no apontamento de produção do `ApontamentoOEE`.
- Restringida a exclusão de turnos OEE a perfis Administrador/Supervisor com validação dinâmica na `tbusuario` e alerta de permissão na UI.
- Ajustada a auditoria de exclusão em `tboee_turno` e tabelas relacionadas para registrar `deleted_at` local e `deleted_by` do usuário autenticado.
- Marcado o campo "Perfil" com indicador visual obrigatório no cadastro de usuários.
- Tornado obrigatório o campo "Perfil" no cadastro de usuários.
- Ajustado o select de perfil em `UsuariosCad` para exibir apenas o texto do perfil quando selecionado.
- Reordenada a coluna "Perfil" para ficar antes de "Login" na tabela de usuários.
- Corrigida validação de autenticação nas páginas `OeeParada` e `OeeParadaCad` para usar UUID do Supabase Auth.
- Removido fallback inválido `'1'` para userId - operações de escrita agora exigem usuário autenticado.
- Adicionada validação de UUID no hook `useOeeParada` antes de operações de INSERT/UPDATE/DELETE.
- Atualizada documentação de tipos em `types/oee-parada.ts` com estrutura completa da tabela `tboee_parada`.
- Criado script de migration `11-tboee-parada.sql` documentando estrutura da tabela e políticas RLS.
- Documentadas as políticas RLS da tabela `tboee_parada`: SELECT/INSERT/UPDATE para usuários autenticados.
- Ajustado o card "Paradas" na Home para redirecionar para `/oee-parada`.
- Adicionado seletor de calendário ao lado dos campos de período do `Dashboard`.
- Ajustado o formato dos campos de período do `Dashboard` para entrada em dd/mm/aaaa no frontend.
- Corrigidos avisos de lint no `ApontamentoOEE` e `Dashboard` (variáveis não utilizadas e tipagem do retorno RPC).
- Ordenada a listagem de cards do `Dashboard` pelo maior OEE, com desempate pelo nome da linha.
- Normalizada a conversão dos percentuais do OEE no `Dashboard` para tratar valores com vírgula e garantir exibição correta.
- Atualizado o design dos cards de OEE no `Dashboard` para usar o mesmo padrão visual do `ApontamentoOEE`: velocímetro SVG inline com cores dinâmicas por percentual, barras de componentes (Disponibilidade, Performance, Qualidade) com gradiente de cores e indicador visual do gap até a meta de 65%.
- Implementado o Dashboard de OEE com filtros dinâmicos e cards por linha usando RPC do Supabase.
- Ajustado o cálculo da "Qtd. Produzida" no controle de lotes para usar valor absoluto e evitar negativos no `ApontamentoOEE`.
- Aumentada a largura do modal de controle de lotes em 40% no `ApontamentoOEE`.
- Adicionada a coluna "Total Produção" no controle de lotes do `ApontamentoOEE`, calculada por quantidade produzida menos perdas.
- Ajustada a validação e o tratamento dos campos "Qtd/Ciclo Inicial" e "Qtd/Ciclo Final" no `ApontamentoOEE` para aceitar valor zero.
- Trocadas as posições das colunas "Data" e "Turno" na tabela do `OeeTurno`.
- Reordenada a coluna "Status" para ficar logo após "Ações" na tabela do `OeeTurno`.
- Adicionada a sublinha com a linha de produção na lista do `OeeTurno`, baseada no `linhaproducao_id`.
- Corrigida a consulta de turnos OEE ao carregar nomes de linha sem join direto, evitando erro 400 no Supabase.
- Ajustada a criação de turnos OEE para persistir `linhaproducao_id` e `linhaproducao` em `tboee_turno`, com fallback de leitura via produção quando dados antigos não tiverem a linha.
- Ajustada a criação de turnos OEE para gravar `created_at` com data e hora local do frontend.
- Atualizado o cálculo do OEE para filtrar produção, paradas e perdas pelo `oeeturno_id`, evitando mistura entre turnos.
- Ajustado o campo de data dos lotes no `ApontamentoOEE` para entrada e exibição em formato brasileiro (dd/mm/aaaa) com validação.
- Tratado erro de sessão expirada ao validar usuário no `ApontamentoOEE`, com limpeza de sessão e aviso para novo login.
- Ajustada a tipagem do gerador de UUID para compatibilidade com build em TypeScript sem depender do tipo global de `crypto`.
- Adicionado fallback de geração de UUID nos apontamentos locais para evitar erro `crypto.randomUUID` em ambientes sem suporte.
- Corrigida a normalização do valor de perdas no `ApontamentoOEE` para evitar escala incorreta ao salvar no banco.
- Melhorada a entrada de perdas no `ApontamentoOEE` com formatação pt-BR em tempo real, limite de 15 dígitos e até 4 casas decimais.
- Corrigida a geração das linhas horárias no registro de produção ao carregar turnos por `oeeturno_id`, exibindo todas as horas do turno com mesclagem dos dados existentes.
- Adicionado redirecionamento do OeeTurno com `oeeturno_id` e exibição do ID no título do Diário de Bordo.
- Removida a funcionalidade de retrabalho no apontamento de qualidade, cálculo do OEE e persistência local.
- Ajustada a ordenação da listagem de velocidades nominais para usar ordem natural/ascendente por linha e depois por referência do produto (ex: 07030001 antes de 07030003 dentro da mesma linha).
- Removido o ícone SVG da coluna "Linha de Produção" na tabela da página de Velocidade Nominal.
- Removida a coluna ID da visualização da tabela na página de Velocidade Nominal.
- Alterado o rótulo do card "Equipamentos" para "Linha de Produção" na página Home.
- Adicionado card de navegação para "Velocidade Nominal" na página Home, redirecionando para `/oee-linha-velocidade`, posicionado logo após o card de "Equipamentos".
- Ajustado o estilo tipográfico do título e subtítulo no `AppHeader` para melhorar legibilidade e hierarquia visual.
- Reduzido o espaçamento vertical entre título e subtítulo no `AppHeader`.
- Ajustado o espaçamento e a altura de linha do bloco de título no `AppHeader`.
- Ajustado o tamanho da logomarca no `AppHeader` para ficar mais proporcional ao cabeçalho.
- Ajustadas a largura e a altura da logomarca no `AppHeader` para ocupar melhor o cabeçalho.
- Ajustada a largura da logomarca no `AppHeader` para 132px.
- Ajustado o padding direito do cabeçalho do `ApontamentoOEE` para alinhar o espaço externo dos botões com a lateral direita.
- Ajustado o estilo e as dimensões dos botões do `ApontamentoOEE` para o padrão visual do `OeeTurno`.
- Ajustado o botão Voltar no `ApontamentoOEE` para sempre redirecionar para `OeeTurno`.
- Removido o botão de Dashboard do cabeçalho do Diário de Bordo no `ApontamentoOEE`.
- Corrigida a dependência de `useEffect` no `useAuth` para evitar avisos de lint e reexecuções desnecessárias.
- Bloqueada a exclusão de registros de produção quando o turno está Encerrado/Fechado, com validação antes do modal e antes da exclusão.
- Corrigida a quebra do modal de busca de SKU quando a lista de produtos não está disponível.
- Ajustadas mensagens de erro do apontamento de produção para indicar falhas de permissão no Supabase.
- Ajustada a busca de tipos de parada para consultar `tboee_parada` no Supabase e removida a exibição de Grande Parada na hierarquia.
- Implementada persistência da produção no Supabase (`tboee_turno_producao`) com CRUD, auditoria e soft delete na guia Produção.
- Integrada a velocidade nominal via `tbvelocidadenominal` para salvar registros de produção.
- Atualizado o cálculo do OEE para usar os dados de produção persistidos no Supabase.
- Estabilizada a função de cálculo de perdas para evitar recriações e dependências instáveis no hook de recálculo do OEE.
- Gerado CSV de produtos para importação na `tbproduto` do Supabase.
- Modal de busca de Produto SKU agora consulta `tbproduto` no Supabase com `deletado = 'N'`.
- Ajustado o carregamento de produção no `ApontamentoOEE` ao abrir turnos pela lista, com fallback por data/turno/produto.
- Ajustado o idioma dos campos de hora do `ApontamentoOEE` para exibição em formato 24h pt-BR.
- Forçado o formato 24h nos campos de hora do `ApontamentoOEE` com entrada textual e normalização de valores.
- Adicionado botão de atualização da consulta no modal de busca de linha de produção.
- Ajustado o layout do bloco de busca do modal de linha de produção para seguir o padrão do OeeTurno.
- Corrigido o alinhamento do botão Atualizar no modal de busca de linha de produção.
- Ajustado o alinhamento responsivo do bloco de busca do modal de linha de produção.
- Ajustado o estilo do campo de busca do modal de linha de produção para seguir o padrão do OeeTurno.
- Ajustado o estilo do seletor de status no modal de linha de produção para seguir o padrão do OeeTurno.
- Adicionada cor marrom suave para o badge de "Embalagem" no modal de busca de linha de produção.
- Adicionada cor âmbar suave para o badge de "Envase+Embalagem" no modal de busca de linha de produção.
- Reordenada a coluna "Status" para ficar logo após "Código" na tabela do modal de busca de linha de produção.
- Alinhado o botão de registro de qualidade com o campo de quantidade no `ApontamentoOEE`.
- Implementada a persistência de perdas de qualidade no Supabase (`tboee_turno_perda`) na guia Qualidade do `ApontamentoOEE`.
- Bloqueado o botão de registro de perdas ao primeiro clique para evitar duplicidade no `ApontamentoOEE`.
- Adicionada linha de totalização da coluna "Quantidade" no histórico de registros de qualidade do `ApontamentoOEE`.
- Ajustada a gravação de `created_at`, `updated_at` e `deleted_at` das perdas para usar data e hora local do frontend (sem GMT).
- Ajustado o cabeçalho e o container principal do `ApontamentoOEE` para permitir truncamento e encolhimento, evitando overflow horizontal em 1280px.
- Ajustado o agrupamento de botões no "Registro de Produção" do `ApontamentoOEE` para permitir quebra de linha e remover rolagem horizontal desnecessária.
- Reduzida a largura dos inputs de "Hora Início" e "Hora Fim" e o espaçamento das colunas no "Registro de Produção" do `ApontamentoOEE`.
